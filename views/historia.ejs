<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Arsenał - Historia Logów</title>
    
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/png" href="/logo-v2.png">
    <link rel="apple-touch-icon" href="/logo-v2.png">
    <meta name="theme-color" content="#0f172a">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --bg-color: #0f172a; --accent: #667eea; --glass: rgba(255,255,255,0.03); --border: rgba(255,255,255,0.1); --text: #fff; }
        
        body { background: var(--bg-color); color: var(--text); font-family: 'Poppins', sans-serif; margin: 0; padding: 40px; min-height: 100vh; }
        
        /* TŁO (to samo co na głównej) */
        .background-blobs { position: fixed; width: 100%; height: 100%; z-index: -1; top: 0; left: 0; }
        .blob { position: absolute; border-radius: 50%; filter: blur(90px); opacity: 0.3; }
        .b1 { top: -10%; left: -10%; width: 600px; height: 600px; background: #764ba2; } 
        .b2 { bottom: -10%; right: -10%; width: 600px; height: 600px; background: #667eea; }

        .container { max-width: 1000px; margin: 0 auto; background: var(--glass); backdrop-filter: blur(20px); padding: 30px; border-radius: 24px; border: 1px solid var(--border); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }

        h1 { margin-top: 0; font-size: 1.8rem; display: flex; align-items: center; gap: 10px; }
        .back-btn { display: inline-flex; align-items: center; gap: 8px; text-decoration: none; color: #94a3b8; margin-bottom: 20px; transition: 0.3s; }
        .back-btn:hover { color: #fff; transform: translateX(-5px); }

        /* TABELA */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { text-align: left; color: #94a3b8; padding: 15px; border-bottom: 1px solid var(--border); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; }
        td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.95rem; color: #fff; /* KLUCZOWE: BIAŁY TEKST */ }
        
        tr:last-child td { border-bottom: none; }
        tr:hover td { background: rgba(255,255,255,0.02); }

        /* BADGE DLA AKCJI */
        .badge { padding: 5px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: bold; text-transform: uppercase; display: inline-block; }
        .badge-DOSTAWA { background: rgba(16, 185, 129, 0.2); color: #10b981; border: 1px solid rgba(16, 185, 129, 0.3); }
        .badge-WYDANIE { background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); }
        .badge-KOREKTA { background: rgba(245, 158, 11, 0.2); color: #f59e0b; border: 1px solid rgba(245, 158, 11, 0.3); }
        .badge-EDYCJA, .badge-MODYFIKACJA { background: rgba(59, 130, 246, 0.2); color: #3b82f6; border: 1px solid rgba(59, 130, 246, 0.3); }
        .badge-USUNIĘCIE { background: rgba(148, 163, 184, 0.2); color: #94a3b8; border: 1px solid rgba(148, 163, 184, 0.3); }
        
        .timestamp { font-family: 'Courier New', monospace; color: #64748b; font-size: 0.85rem; }

        /* RESPANSYWNOŚĆ */
        @media (max-width: 600px) {
            body { padding: 15px; }
            td, th { padding: 10px 5px; font-size: 0.8rem; }
            .badge { padding: 3px 6px; font-size: 0.65rem; }
        }
    </style>
</head>
<body>
    <div class="background-blobs"><div class="blob b1"></div><div class="blob b2"></div></div>
<nav class="sidebar">
    <div class="logo"><i class="fa-solid fa-shield-halved"></i> SYSTEM ARSENAŁ</div>
    <a href="/" class="nav-item"><i class="fa-solid fa-layer-group"></i> Magazyn</a>
    
    <% if(typeof user !== 'undefined' && user.rola === 'Administrator') { %>
        <a href="/uzytkownicy" class="nav-item"><i class="fa-solid fa-users"></i> Użytkownicy</a>
    <% } %>

    <a href="/historia" class="nav-item"><i class="fa-solid fa-list"></i> Logi</a>
    
    <div style="margin-top:auto">
        <% if(typeof user !== 'undefined') { %>
            <div style="padding: 10px; font-size: 0.8rem; color: #64748b;">
                <%= user.imie %> <%= user.nazwisko %> <br>
                <span style="color:var(--accent)"><%= user.rola %></span>
            </div>
        <% } %>
        <form action="/logout" method="POST"><button style="background:none; border:none; color:#ff4757; cursor:pointer;">Wyloguj</button></form>
    </div>
</nav>
    <div class="container">
        <a href="/" class="back-btn"><i class="fa-solid fa-arrow-left"></i> Wróć do Magazynu</a>
        
        <h1><i class="fa-solid fa-clock-rotate-left"></i> Dziennik Operacyjny</h1>
        <p style="color:#64748b; margin-top:-10px; margin-bottom:30px;">Pełna historia zdarzeń w systemie Arsenał.</p>

        <% if (logi.length === 0) { %>
            <div style="text-align:center; padding:40px; color:#64748b;">
                <i class="fa-regular fa-folder-open" style="font-size:2rem; margin-bottom:10px;"></i>
                <p>Brak wpisów w dzienniku.</p>
            </div>
        <% } else { %>
            <table>
                <thead>
                    <tr>
                        <th>Czas</th>
                        <th>Akcja</th>
                        <th>Szczegóły</th>
                    </tr>
                </thead>
                <tbody>
                    <% logi.forEach(linia => { 
                        // Parsowanie linii: [Data] [AKCJA] Opis
                        // Używamy prostego wyrażenia regularnego, żeby wyciągnąć to co w nawiasach
                        const match = linia.match(/\[(.*?)\] \[(.*?)\] (.*)/);
                        
                        if (match) {
                            const czas = match[1];
                            const akcja = match[2];
                            const opis = match[3];
                    %>
                        <tr>
                            <td class="timestamp"><%= czas %></td>
                            <td><span class="badge badge-<%= akcja %>"><%= akcja %></span></td>
                            <td><%= opis %></td>
                        </tr>
                    <% } else { %>
                        <tr>
                            <td colspan="3" style="color:#64748b;"><%= linia %></td>
                        </tr>
                    <% } }) %>
                </tbody>
            </table>
        <% } %>
    </div>
</body>
</html>