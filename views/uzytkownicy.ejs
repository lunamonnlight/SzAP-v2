<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Arsenał - Kadry</title>
    
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/png" href="/logo-v2.png">
    <link rel="apple-touch-icon" href="/logo-v2.png">
    <meta name="theme-color" content="#0f172a">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --bg-color: #0f172a; --accent: #667eea; --glass: rgba(255,255,255,0.03); --border: rgba(255,255,255,0.1); --text: #fff; --success: #10b981; }
        
        body { background: var(--bg-color); color: var(--text); font-family: 'Poppins', sans-serif; margin: 0; display: flex; min-height: 100vh; }
        
        .background-blobs { position: fixed; width: 100%; height: 100%; z-index: -1; }
        .blob { position: absolute; border-radius: 50%; filter: blur(90px); opacity: 0.3; }
        .b1 { top: -10%; left: -10%; width: 600px; height: 600px; background: #764ba2; } 
        .b2 { bottom: -10%; right: -10%; width: 600px; height: 600px; background: #667eea; }

        .sidebar { width: 280px; background: rgba(15,23,42,0.8); backdrop-filter: blur(20px); border-right: 1px solid var(--border); padding: 40px 30px; display: flex; flex-direction: column; position: sticky; top: 0; height: 100vh; }
        .nav-item { padding: 14px 20px; margin-bottom: 8px; border-radius: 14px; color: #94a3b8; display: flex; align-items: center; gap: 15px; text-decoration: none; transition: 0.3s; }
        .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.05); color: #fff; }
        .logo { font-size: 1.5rem; font-weight: 800; margin-bottom: 60px; color: #fff; display:flex; align-items:center; gap:10px; }

        .main { flex: 1; padding: 50px; width: 100%; }

        .header-section { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
        .btn-add { background: var(--success); color: #fff; border: none; padding: 12px 24px; border-radius: 12px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: 0.2s; }
        .btn-add:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4); }

        /* TABELA */
        .table-container { background: var(--glass); backdrop-filter: blur(20px); border-radius: 24px; border: 1px solid var(--border); overflow: hidden; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 20px; background: rgba(0,0,0,0.2); color: #94a3b8; font-size: 0.85rem; text-transform: uppercase; }
        td { padding: 20px; border-bottom: 1px solid var(--border); }
        tr:last-child td { border-bottom: none; }
        tr:hover { background: rgba(255,255,255,0.02); }

        .user-info { display: flex; align-items: center; gap: 15px; }
        .avatar { width: 40px; height: 40px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #fff; }
        
        .role-badge { padding: 5px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: bold; text-transform: uppercase; }
        .role-Administrator { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .role-Logistyk { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .role-Dowódca { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }

        /* MODAL */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: none; justify-content: center; align-items: center; z-index: 999; backdrop-filter: blur(5px); }
        .modal-overlay.active { display: flex; }
        .modal { background: #1e293b; padding: 40px; border-radius: 20px; width: 400px; border: 1px solid var(--border); }
        input, select { background: rgba(0,0,0,0.3); border: 1px solid var(--border); padding: 15px; border-radius: 12px; color: #fff; width: 100%; box-sizing: border-box; margin-bottom: 15px; }
        
        .btn-submit { background: var(--accent); border: none; color: #fff; padding: 15px; border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>
    <div class="background-blobs"><div class="blob b1"></div><div class="blob b2"></div></div>

    <nav class="sidebar">
        <div class="logo"><i class="fa-solid fa-shield-halved"></i> SYSTEM ARSENAŁ</div>
        <a href="/" class="nav-item"><i class="fa-solid fa-layer-group"></i> Magazyn</a>
        <a href="/uzytkownicy" class="nav-item active"><i class="fa-solid fa-users"></i> Użytkownicy</a>
        <a href="/historia" class="nav-item"><i class="fa-solid fa-list"></i> Logi</a>
        <div style="margin-top:auto">
            <div style="padding: 15px; background: rgba(255,255,255,0.05); border-radius: 12px; margin-bottom: 10px;">
                <div style="font-size: 0.8rem; color: #94a3b8;">Zalogowany jako:</div>
                <div style="font-weight: bold;"><%= user.imie %> <%= user.nazwisko %></div>
                <div style="font-size: 0.7rem; color: var(--accent);"><%= user.rola %></div>
            </div>
            <form action="/logout" method="POST"><button style="background:none; border:none; color:#ff4757; cursor:pointer;">Wyloguj</button></form>
        </div>
    </nav>

    <main class="main">
        <div class="header-section">
            <div>
                <h1 style="margin:0">Zarządzanie Kadrami</h1>
                <p style="color:#94a3b8; margin:0">Lista personelu i uprawnienia</p>
            </div>
            <button onclick="document.getElementById('addModal').classList.add('active')" class="btn-add">
                <i class="fa-solid fa-user-plus"></i> Dodaj Użytkownika
            </button>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Użytkownik</th>
                        <th>Jednostka</th>
                        <th>Rola / Uprawnienia</th>
                        <th>Login</th>
                        <th>Akcje</th>
                    </tr>
                </thead>
                <tbody>
                    <% users.forEach(u => { %>
                        <tr>
                            <td>
                                <div class="user-info">
                                    <div class="avatar"><%= u.imie.charAt(0) %><%= u.nazwisko.charAt(0) %></div>
                                    <div>
                                        <div style="font-weight:bold"><%= u.imie %> <%= u.nazwisko %></div>
                                    </div>
                                </div>
                            </td>
                            <td><%= u.jednostka || '---' %></td>
                            <td><span class="role-badge role-<%= u.rola %>"><%= u.rola %></span></td>
                            <td style="font-family:monospace; color:#94a3b8;"><%= u.login %></td>
                            <td>
                                <% if (u.id !== user.id) { %>
                                    <form action="/uzytkownicy/usun/<%= u.id %>" method="POST" onsubmit="return confirm('Usunąć dostęp żołnierzowi?');">
                                        <button type="submit" style="background:none; border:none; color:#ef4444; cursor:pointer;"><i class="fa-solid fa-user-xmark"></i></button>
                                    </form>
                                <% } else { %>
                                    <span style="color:#64748b; font-size:0.8rem;">(Ty)</span>
                                <% } %>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
        <div style="margin-top: 60px; border-top: 1px solid var(--border); padding-top: 40px;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <h2 style="margin:0; color:#fff;"><i class="fa-solid fa-server"></i> Strefa Techniczna</h2>
                    <p style="color:#94a3b8; margin:5px 0 0;">Zarządzanie bezpieczeństwem danych i kopiami zapasowymi (SYS-UC14)</p>
                </div>
                
                <form action="/admin/backup" method="POST">
                    <button type="submit" style="background: #6366f1; color: #fff; border: none; padding: 15px 30px; border-radius: 12px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 1rem; transition: 0.3s;">
                        <i class="fa-solid fa-database"></i> WYKONAJ PEŁNY BACKUP
                    </button>
                </form>
            </div>

            <div style="margin-top: 20px; background: rgba(0,0,0,0.2); padding: 20px; border-radius: 12px; border: 1px dashed #64748b; color: #94a3b8; font-family: monospace;">
                STATUS SYSTEMU: ONLINE<br>
                LOKALIZACJA KOPII: /backups/<br>
                RETENCJA DANYCH: 30 DNI
            </div>
        </div>
    </main>

    <div class="modal-overlay" id="addModal">
        <div class="modal">
            <h2 style="margin-top:0; color:#fff;">Nowy Użytkownik</h2>
            <form action="/uzytkownicy/dodaj" method="POST">
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <input type="text" name="imie" placeholder="Imię" required>
                    <input type="text" name="nazwisko" placeholder="Nazwisko" required>
                </div>
                
                <input type="text" name="jednostka" placeholder="Jednostka / Przydział" required>
                
                <select name="rola">
                    <option value="Logistyk">Logistyk</option>
                    <option value="Dowódca">Dowódca</option>
                    <option value="Administrator">Administrator</option>
                    <option value="Pracownik Magazynu">Pracownik Magazynu</option>
                </select>

                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <input type="text" name="login" placeholder="Login" required>
                    <input type="password" name="haslo" placeholder="Hasło" required>
                </div>

                <div style="display:flex; gap:10px; margin-top:20px;">
                    <button type="button" onclick="document.getElementById('addModal').classList.remove('active')" style="background:#333; color:#fff; border:none; padding:15px; border-radius:12px; cursor:pointer;">Anuluj</button>
                    <button type="submit" class="btn-submit">Utwórz konto</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        window.onclick = function(e) {
            if(e.target.classList.contains('modal-overlay')) e.target.classList.remove('active');
        }
    </script>
</body>
</html>